<!DOCTYPE html>
<html>
<head>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.js"></script>	
    <script src="js/p5.dom.js"></script>

	<title>Testing ThreeJS</title>

	<style>

		/*To make sure canvas cover the entire browser*/
		body{
			margin: 0;
		}
		canvas{
			width: 100%;
			height: 100%;
		}
		#info{
			position: absolute;
			top: 10px;
			width: 100%;
			text-align: center;
			z-index: 100;
			display:block;
		}
		#p5Div, #threejsDiv {
        position: absolute;
        top: 0;
        left: 0;
      	}
      	#p5Div {
        z-index: 1;
      }
	</style>

</head>
<body>
	
	<div id="info">
		
		<h1>Audio Visualizer</h1>
		<h4>Faculty of Engineering, University of Peradeniya</h4>
		<input type="submit" name="one">
		<input type="submit" name="two">
		<input type="submit" name="three">


	</div>
	<div id='p5Div'></div>
    <div id='threejsDiv'></div>

</body>

<script>


/*function preload(){
	song = loadSound("test.mp3");
}*/



//initialize the page
function setup() {
	var canvas,playButton,forwardButton,backwardButton,input,amp;

	var number=1;
	var val = 0.5;

	var song,colorP5;
	var colorChange = true;
	canvas = createCanvas(windowWidth,windowHeight);
	canvas.parent('p5Div');
	canvas.mousePressed(tooglePlay);

	input = createFileInput(uploaded);
	input.position(0,windowHeight-100);

	backwardButton = createButton('<<');
	backwardButton.position(input.width,windowHeight-100);
	backwardButton.mousePressed(backwardSong);

	playButton = createButton('Play');
	playButton.style('width','50')
	playButton.position(backwardButton.width+backwardButton.x,windowHeight-100);
	playButton.mousePressed(tooglePlay);

	forwardButton = createButton('>>');
	forwardButton.position(playButton.width+playButton.x,windowHeight-100);
	forwardButton.mousePressed(forwardSong);

	amp = new p5.Amplitude();

	//playing sound in preload method
	//song.play();

	//loading sound in callback method
	
}
function backwardSong(){
	song.jump(song.currentTime()-5);
}
function forwardSong(){
	song.jump(song.currentTime()+5);
}

function uploaded(file){
	if(song!=null){
		song.stop();
	}
	song = loadSound(file,doneLoading);
	song.setVolume(val);
}

function doneLoading(){
	
	tooglePlay();
}

//calls infinitely
function draw(){
	clear();
	/*if(colorChange){
		colorP5 = random(255);
		background(colorP5);
	}*/

	var vol = amp.getLevel();

	//fill(random(255),random(255),random(255));
	noStroke();
	fill(255,0,random(255));
	ellipse(width/2,height/2,vol*width/val,vol*width/val);

	//fill(random(255),random(255),random(255));
	noStroke();
	fill(255,0,random(255));
	ellipse(width/2,height/2,0.5*vol*width/val,0.5*vol*width/val);

}

function keyPressed() {
  if (keyCode === UP_ARROW) {
  	if(val!=1)val = val+0.1;
    song.setVolume(val);
  } else if (keyCode === DOWN_ARROW) {
    if(val!=0)val = val-0.1;
    song.setVolume(val);
  }
}

function tooglePlay(){
	if(song.isPlaying()){
		song.pause();
		playButton.html('Play');
		colorChange = false;
	}
	else{
		song.play();
		playButton.html('Pause');
		colorChange = true;
	}
}


var scene = new THREE.Scene();

    /*User see the world through this*/
    /*PerspectiveCamera or OrthographicCamera*/
    /*parameters - Degrees, Ratio of our browser, near Clipping Plane, Far Clipping Plane*/
    var cam =  new THREE.PerspectiveCamera(75, window.innerWidth/ window.innerHeight, 0.1, 100000);

    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    window.addEventListener('resize', function(){
      var width = window.innerWidth;
      var height = window.innerHeight;
      renderer.setSize(width, height);
      cam.aspect = width/height;
      cam.updateProjectionMatrix();
    });

    /*var effect = new THREE.AnaglyphEffect(renderer);
    effect.setSize(window.innerWidth, window.innerHeight);*/



    //controls = new THREE.OrbitControls(cam, renderer.domElement);


    //create the shape
    //var geometry = new THREE.BoxGeometry(2, 2, 2);
    var geometry1 = new THREE.BoxGeometry(10000, 10000, 10000);

    //create a material colour or image texture
    /*var cubeMaterial = [
      new THREE.MeshPhongMaterial({color:0xFFFFFF,side:THREE.DoubleSide}),//right side
      new THREE.MeshPhongMaterial({color:0xFFFFFF,side:THREE.DoubleSide}),//left side
      new THREE.MeshLambertMaterial({map:new THREE.TextureLoader().load('Images/Era.jpg'),side:THREE.DoubleSide}),//top side
      new THREE.MeshLambertMaterial({map:new THREE.TextureLoader().load('Images/Era.jpg'),side:THREE.DoubleSide}),//bottom side
      new THREE.MeshPhongMaterial({map:new THREE.TextureLoader().load('Images/Era.jpg'),side:THREE.DoubleSide}),//front side
      new THREE.MeshPhongMaterial({map:new THREE.TextureLoader().load('Images/Era.jpg'),side:THREE.DoubleSide})//back side
    ];
*/
    var cubeMaterial1 = [
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_ft.png'),side:THREE.DoubleSide}),//front side
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_bk.png'),side:THREE.DoubleSide}),//back side
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_up.png'),side:THREE.DoubleSide}),//top side
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_dn.png'),side:THREE.DoubleSide}),//bottom side
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_rt.png'),side:THREE.DoubleSide}),//right side
      new THREE.MeshBasicMaterial({map:new THREE.TextureLoader().load('Images/sky/violentdays_lf.png'),side:THREE.DoubleSide})//left side
    ];
    /*var material = new THREE.MeshFaceMaterial(cubeMaterial);
    var cube= new THREE.Mesh(geometry,material);
    scene.add(cube);*/

    var material1 = new THREE.MeshFaceMaterial(cubeMaterial1);
    var cube1= new THREE.Mesh(geometry1,material1);
    scene.add(cube1);

    cam.position.z=3;

    var ambientL = new THREE.AmbientLight(0xFFFFFF, 0.8);
    scene.add(ambientL);

    //Logic
    var update = function(){

    };


    //draw scene
    var render = function(){

      renderer.render(scene,cam);

    };


    //run game loop(update, render, repeat)
    var GameLoop = function(){

      requestAnimationFrame(GameLoop);

      update();
      render();
    };

    GameLoop();


</script>

</html>